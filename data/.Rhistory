divmean.cor.preyr.plot <-
ggplot(data=subset(divMeanH3H1.cor.h3h1seq,!is.na(predom_strain)),
aes(x=preORdes,y=Inci_H3_max,fill=predom_strain))+geom_boxplot()+
theme_classic()+labs(fill='Predominant strain',
y='H3 peak incidence in a year',x='')+
scale_x_discrete(labels=c("des_yr_divmeanpredom"="Strain predominance in\nthe following year",
"pre_yr_divmeanpredom"="Strain predominance in\nthe previous year"))
divmean.cor.preyr.plot
# divmean.cor.desyr.plot <- ggplot(subset(divMeanH3H1.cor.h3h1seq,
#                                         !is.na(des_yr_divmeanpredom)),
#                                  aes(des_yr_divmeanpredom,prva_H3_max)) +
#   geom_boxplot()+theme_classic()+labs(x='Predominant strain next year',
#                                       y='H3 peak incidence in a year')
divmean.cor.preyr.plot.avainci <- ggplot(data=subset(divMeanH3H1.cor.h3h1seq,
!is.na(pre_yr_divmeanpredom)),
aes(x=pre_yr_divmeanpredom,y=prva_H3_mean))+
geom_boxplot()+theme_classic()+labs(x='Predominant strain in previous year',
y='H3 average incidence in a year')
view(divMeanH3H1.cor.h3h1seq)
H3_predom_prop.plot
ggsave('divMean+H3predom_latDesc_Ntemp.png',
gridExtra::arrangeGrob(divmean.p,H3_predom_prop.plot,ncol = 2,widths = c(0.8,0.2)),
width=10,height=10)
ggsave('divMean+H3predom_latDesc_Ntemp.png',
gridExtra::arrangeGrob(divmean.p,H3_predom_prop.plot,ncol = 2,widths = c(0.8,0.2)),
width=12,height=8)
ggsave('divMean+H3predom_latDesc_Ntemp.png',
gridExtra::arrangeGrob(divmean.p,H3_predom_prop.plot,ncol = 2,widths = c(0.8,0.2)),
width=12,height=7)
divMeanH3H1 <- divMeanH3H1 %>%
filter(Year>2009)
delMeanH3H1 <- delMeanH3H1 %>%
filter(Year>2009)
# # country - latitude
coords <- read.csv('~/Documents/P3_UIV/data/countries_codes_and_coordinates.csv')
divMeanH3H1 <- left_join(divMeanH3H1.ori,coords,by='Country')
delMeanH3H1 <- left_join(delMeanH3H1.ori,coords,by='Country')
country.order <- unique(arrange(divMeanH3H1,Latitude..average.)$Country)
divMeanH3H1$Country <- factor(divMeanH3H1$Country, levels=country.order)
country.order_del <- unique(arrange(delMeanH3H1,Latitude..average.)$Country)
delMeanH3H1$Country <- factor(delMeanH3H1$Country, levels=country.order_del)
predom_count <- divMeanH3H1 %>%
dplyr::group_by(Country,divmeanpredom) %>%
dplyr::summarise(count=n())
total_count <- predom_count %>%
dplyr::group_by(Country) %>%
dplyr::summarise(total_count=sum(count))
H3_predom_prop <- dplyr::filter(predom_count,
divmeanpredom=='H3 has higher average incidence') %>%
dplyr::left_join(total_count,by='Country') %>%
mutate(H3_predom_prop=count/total_count) %>%
dplyr::left_join(coords,by='Country')
# # interval of h3 predominance
predom.yrs <- divMeanH3H1 %>%
group_by(Country,divmeanpredom) %>%
dplyr::arrange(Year) %>%
dplyr::mutate(yr.id=cumsum(c(1,diff(Year)>1)))
predom.yr.stats <- predom.yrs %>%
group_by(Country,divmeanpredom,yr.id) %>%
summarise(yr.n=n()) %>%
mutate(strain_predom=substr(divmeanpredom,start = 1,stop = 2))
# predom.yrs$Country <- factor(predom.yrs$Country,levels = country.order)
# predom.yrs.stats$Country <- factor(predom.yrs.stats$Country, levels=country.order)
predom.yrs.num.plot <- ggplot(data=predom.yr.stats,aes(x=yr.n,y=Country,fill=strain_predom))+
geom_boxplot()+
scale_fill_manual(values=c('#b4464b','steelblue'))+
theme_bw()+
theme(
# axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.title.x = element_text(size=9))+
labs(x='Number of consecutive\npredominant years',fill='Predominant\nstrain')
H3_predom_prop.plot <- H3_predom_prop %>%
ggplot(aes(x=H3_predom_prop,y=Country))+
geom_bar(stat = "identity",fill='steelblue')+
theme_bw()+
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.title.x = element_text(size=9))+
labs(x='Proportion of H3-predominant years')
divmean.p <- ggplot(data=divMeanH3H1,aes(x=Year,y=Country))+
geom_raster(aes(fill=peakInci),hjust = 0) +
scale_fill_gradient2(low="#b4464b", mid="lightgrey", high="steelblue",
na.value = "white") +
geom_hline(yintercept = seq_along(divMeanH3H1$Country) + 0.5) +
theme_bw(base_size = 10) +
annotate("rect", xmin = 2009, xmax = 2010,
ymin=seq_along(divMeanH3H1$Country)[1]-0.5,
ymax=seq_along(divMeanH3H1$Country)[length(unique(divMeanH3H1$Country))]+0.5)+
theme(panel.background = element_blank(),
panel.grid.major.x = element_line(color = "black"),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.ontop = TRUE,
axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
legend.title = element_blank(),
legend.text = element_text(size=9)) +
scale_x_continuous(breaks=seq(min(divMeanH3H1$Year)-1,max(divMeanH3H1$Year)))
predom.yrs.divmean.noh1h3grp <- divMeanH3H1 %>%
group_by(Country) %>%
arrange(Year) %>%
mutate(yr.id=cumsum(c(1,diff(Year)>1)))
divMeanH3H1.cor.h3h1seq <- predom.yrs.divmean.noh1h3grp %>%
dplyr::group_by(Country,yr.id) %>%
dplyr::mutate(pre_yr_divmeanpredom=dplyr::lag(divmeanpredom, order_by=Year),
des_yr_divmeanpredom=dplyr::lead(divmeanpredom, order_by=Year))
divMeanH3H1.cor.h3h1seq <- divMeanH3H1.cor.h3h1seq %>%
pivot_longer(c(pre_yr_divmeanpredom,des_yr_divmeanpredom),
names_to = 'preORdes', values_to = 'predom_strain')
divmean.cor.preyr.plot <-
ggplot(data=subset(divMeanH3H1.cor.h3h1seq,!is.na(predom_strain)),
aes(x=preORdes,y=Inci_H3_max,fill=predom_strain))+geom_boxplot()+
theme_classic()+labs(fill='Predominant strain',
y='H3 peak incidence in a year',x='')+
scale_x_discrete(labels=c("des_yr_divmeanpredom"="Strain predominance in\nthe following year",
"pre_yr_divmeanpredom"="Strain predominance in\nthe previous year"))
ggsave('divMean_latDesc.png',divmean.p,width=10,height=15)
ggsave('divMean+H3predom_latDesc.png',
gridExtra::arrangeGrob(divmean.p,H3_predom_prop.plot,ncol = 2,widths = c(0.8,0.2)),
width=12,height=7)
cases_wd_final <- cases_wd_gdSubtype %>%
filter(((is.na(Inci_H1)==FALSE) & Inci_H1<=1 | is.na(Inci_H1==TRUE)) & ((is.na(Inci_H1pdm)==FALSE) & Inci_H1pdm<=1 | is.na(Inci_H1pdm==TRUE)) &
((is.na(Inci_H3)==FALSE) & Inci_H3<=1 | is.na(Inci_H3==TRUE)) &
((is.na(Inci_H1_Total)==FALSE) & Inci_H1_Total<=1 | is.na(Inci_H1_Total==TRUE)) )
summary <- cases_wd_final %>%
group_by(Country,Year) %>%
summarise_at(vars(Inci_H3,Inci_H1_Total),
list(min=min,Q1=~quantile(.,probs = 0.25,na.rm=TRUE),
mean=mean,median=median,
Q3=~quantile(.,probs = 0.75,na.rm=TRUE),max=max),na.rm=TRUE)
summary['divmeanH3H1']=summary['Inci_H3_mean']/summary['Inci_H1_Total_mean']
summary['delmeanH3H1']=summary['Inci_H3_mean']-summary['Inci_H1_Total_mean']
summary['divmaxH3H1']=summary['Inci_H3_max']/summary['Inci_H1_Total_max']
summary['delmaxH3H1']=summary['Inci_H3_max']-summary['Inci_H1_Total_max']
# # pre/post pandemic number of years with predominance of H3
# setwd('~/Documents/P3_UIV/data/statistics/')
divMeanH3H1.h3 <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1>1) %>%
mutate(divmeanpredom = as.factor('H3 has higher average incidence'),
peakInci = Inci_H3_max)
divMeanH3H1.h1 <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1<1) %>%
mutate(divmeanpredom = as.factor('H1 has higher average incidence'),
peakInci = -Inci_H1_Total_max)
divMeanH3H1.eq <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1==1) %>%
mutate(divmeanpredom = as.factor('Equal Average Incidence'),
peakInci = 0)
divMeanH3H1 <- bind_rows(divMeanH3H1.h1,divMeanH3H1.h3,divMeanH3H1.eq)
# divMeanH3H1 <- divMeanH3H1 %>%
#   filter(Year>2008)
Country_num <- length(unique(divMeanH3H1$Country))
delmeanH3H1.h3 <- summary %>%
select(Country,Year,delmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(delmeanH3H1>0) %>%
mutate(delmeanpredom = as.factor('H3 has higher average incidence'),
peakInci=Inci_H3_max)
delmeanH3H1.h1 <- summary %>%
select(Country,Year,delmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(delmeanH3H1<0) %>%
mutate(delmeanpredom = as.factor('H1 has higher average incidence'),
peakInci=-Inci_H1_Total_max)
delmeanH3H1.eq <- summary %>%
select(Country,Year,delmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(delmeanH3H1==0) %>%
mutate(delmeanpredom = as.factor('Equal average incidence'),
peakInci=0)
delMeanH3H1 <- bind_rows(delmeanH3H1.h1,delmeanH3H1.h3,delmeanH3H1.eq)
# library(tidyverse)
# library(dplyr)
divMeanH3H1.ori <- divMeanH3H1
delMeanH3H1.ori <- delMeanH3H1
# # country - latitude
coords <- read.csv('~/Documents/P3_UIV/data/countries_codes_and_coordinates.csv')
divMeanH3H1 <- left_join(divMeanH3H1.ori,coords,by='Country')
delMeanH3H1 <- left_join(delMeanH3H1.ori,coords,by='Country')
country.order <- unique(arrange(divMeanH3H1,Latitude..average.)$Country)
divMeanH3H1$Country <- factor(divMeanH3H1$Country, levels=country.order)
country.order_del <- unique(arrange(delMeanH3H1,Latitude..average.)$Country)
delMeanH3H1$Country <- factor(delMeanH3H1$Country, levels=country.order_del)
delMaxH3H1 <- left_join(delMaxH3H1.ori,coords,by='Country')
divMeanH3H1.Ntemp <- divMeanH3H1 %>%
filter(Latitude..average.>23.5)
predom_count <- divMeanH3H1 %>%
dplyr::group_by(Country,divmeanpredom) %>%
dplyr::summarise(count=n())
total_count <- predom_count %>%
dplyr::group_by(Country) %>%
dplyr::summarise(total_count=sum(count))
H3_predom_prop <- dplyr::filter(predom_count,
divmeanpredom=='H3 has higher average incidence') %>%
dplyr::left_join(total_count,by='Country') %>%
mutate(H3_predom_prop=count/total_count) %>%
dplyr::left_join(coords,by='Country')
# # interval of h3 predominance
predom.yrs <- divMeanH3H1 %>%
group_by(Country,divmeanpredom) %>%
dplyr::arrange(Year) %>%
dplyr::mutate(yr.id=cumsum(c(1,diff(Year)>1)))
predom.yr.stats <- predom.yrs %>%
group_by(Country,divmeanpredom,yr.id) %>%
summarise(yr.n=n()) %>%
mutate(strain_predom=substr(divmeanpredom,start = 1,stop = 2))
# predom.yrs$Country <- factor(predom.yrs$Country,levels = country.order)
# predom.yrs.stats$Country <- factor(predom.yrs.stats$Country, levels=country.order)
predom.yrs.num.plot <- ggplot(data=predom.yr.stats,aes(x=yr.n,y=Country,fill=strain_predom))+
geom_boxplot()+
scale_fill_manual(values=c('#b4464b','steelblue'))+
theme_bw()+
theme(
# axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.title.x = element_text(size=9))+
labs(x='Number of consecutive\npredominant years',fill='Predominant\nstrain')
H3_predom_prop.plot <- H3_predom_prop %>%
ggplot(aes(x=H3_predom_prop,y=Country))+
geom_bar(stat = "identity",fill='steelblue')+
theme_bw()+
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.title.x = element_text(size=9))+
labs(x='Proportion of H3-predominant years')
divmean.p <- ggplot(data=divMeanH3H1,aes(x=Year,y=Country))+
geom_raster(aes(fill=peakInci),hjust = 0) +
scale_fill_gradient2(low="#b4464b", mid="lightgrey", high="steelblue",
na.value = "white") +
geom_hline(yintercept = seq_along(divMeanH3H1$Country) + 0.5) +
theme_bw(base_size = 10) +
annotate("rect", xmin = 2009, xmax = 2010,
ymin=seq_along(divMeanH3H1$Country)[1]-0.5,
ymax=seq_along(divMeanH3H1$Country)[length(unique(divMeanH3H1$Country))]+0.5)+
theme(panel.background = element_blank(),
panel.grid.major.x = element_line(color = "black"),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.ontop = TRUE,
axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
legend.title = element_blank(),
legend.text = element_text(size=9)) +
scale_x_continuous(breaks=seq(min(divMeanH3H1$Year)-1,max(divMeanH3H1$Year)))
predom.yrs.divmean.noh1h3grp <- divMeanH3H1 %>%
group_by(Country) %>%
arrange(Year) %>%
mutate(yr.id=cumsum(c(1,diff(Year)>1)))
divMeanH3H1.cor.h3h1seq <- predom.yrs.divmean.noh1h3grp %>%
dplyr::group_by(Country,yr.id) %>%
dplyr::mutate(pre_yr_divmeanpredom=dplyr::lag(divmeanpredom, order_by=Year),
des_yr_divmeanpredom=dplyr::lead(divmeanpredom, order_by=Year))
divMeanH3H1.cor.h3h1seq <- divMeanH3H1.cor.h3h1seq %>%
pivot_longer(c(pre_yr_divmeanpredom,des_yr_divmeanpredom),
names_to = 'preORdes', values_to = 'predom_strain')
divmean.cor.preyr.plot <-
ggplot(data=subset(divMeanH3H1.cor.h3h1seq,!is.na(predom_strain)),
aes(x=preORdes,y=Inci_H3_max,fill=predom_strain))+geom_boxplot()+
theme_classic()+labs(fill='Predominant strain',
y='H3 peak incidence in a year',x='')+
scale_x_discrete(labels=c("des_yr_divmeanpredom"="Strain predominance in\nthe following year",
"pre_yr_divmeanpredom"="Strain predominance in\nthe previous year"))
ggsave('divMean_latDesc.png',divmean.p,width=10,height=15)
ggsave('divMean+H3predom_latDesc.png',
gridExtra::arrangeGrob(divmean.p,H3_predom_prop.plot,ncol = 2,widths = c(0.8,0.2)),
width=12,height=7)
# case data exploration
setwd("~/Documents/P3_UIV/data/")
library(tidyverse)
library(ggplot2)
pop <- tibble(read.csv("pop_total_95_20.csv",check.names = FALSE)) %>%
pivot_longer(cols='1995':'2020',names_to='XYear',values_to='Population') %>%
mutate(year=as.numeric(XYear)) %>%
select(-XYear)
cases_wd <- tibble(read.csv("WHO_FluNet_All_Countries_1995_2019.csv"))
cases_wd[cases_wd[,'Country']=='Kosovo (in accordance with Security Council resolution 1244 (1999))',
'Country']= 'Kosovo'
cases_US <- tibble(read.csv("US_HHS_viral_2009_2010.csv"))
yrs_cases_US <- sort(unique(cases_US$year))
yrs_cases_wd <- sort(unique(cases_wd$Year))
# wks<-52
wks <- sort(unique(cases_US$week))
regions <- unique(cases_wd$Influenza_transmission_zone)
cases_wd <- cases_wd %>%
mutate(A_subtyped=A_Total-A_not_subtyped,
B_subtyped=B_Total-B_not_subtyped,
AsubtypeRatio=1-A_not_subtyped/A_Total,
BsubtypeRatio=1-B_not_subtyped/B_Total,
subtypeRatio=1-(A_not_subtyped+B_not_subtyped)/(A_Total+B_Total)) %>%
inner_join(y=pop,by=c('Country'='Country Name','Year'='year')) %>%
# incidence - denominator: population in the year
mutate(Inci_A=A_Total/Population,Inci_H3=A_H3/Population,
Inci_H1=A_H1/Population,Inci_H1pdm=A_H1N1pdm09/Population,
Inci_H1_Total=(A_H1+A_H1N1pdm09)/Population,
Inci_H5=A_H5/Population,Inci_B=B_Total/Population,Inci_Yam=
B_Yamagata/Population,Inci_Vict=B_Victoria/Population)
# remove countries whose subtyping ability of Subtype A is lower than average level
countries_GdSubtyp <- cases_wd %>%
filter(!is.na(AsubtypeRatio)&Year!=2009&Year!=2010) %>%
group_by(Country) %>%
summarize_at(vars(A_subtyped:Inci_H1pdm),mean,na.rm=TRUE) %>%
# filter(rank(desc(A_subtyped)) < 31) %>%
filter(rank(desc(Population))<31) %>%
filter(rank(desc(A_subtyped)) < 21)
Countries_GoodSubtyp <- unlist(countries_GdSubtyp['Country'])
cases_wd_gdSubtype <- cases_wd %>%
filter(Country %in% Countries_GoodSubtyp)
cases_wd_final <- cases_wd_gdSubtype %>%
filter(((is.na(Inci_H1)==FALSE) & Inci_H1<=1 | is.na(Inci_H1==TRUE)) & ((is.na(Inci_H1pdm)==FALSE) & Inci_H1pdm<=1 | is.na(Inci_H1pdm==TRUE)) &
((is.na(Inci_H3)==FALSE) & Inci_H3<=1 | is.na(Inci_H3==TRUE)) &
((is.na(Inci_H1_Total)==FALSE) & Inci_H1_Total<=1 | is.na(Inci_H1_Total==TRUE)) )
summary <- cases_wd_final %>%
group_by(Country,Year) %>%
summarise_at(vars(Inci_H3,Inci_H1_Total),
list(min=min,Q1=~quantile(.,probs = 0.25,na.rm=TRUE),
mean=mean,median=median,
Q3=~quantile(.,probs = 0.75,na.rm=TRUE),max=max),na.rm=TRUE)
summary['divmeanH3H1']=summary['Inci_H3_mean']/summary['Inci_H1_Total_mean']
summary['delmeanH3H1']=summary['Inci_H3_mean']-summary['Inci_H1_Total_mean']
summary['divmaxH3H1']=summary['Inci_H3_max']/summary['Inci_H1_Total_max']
summary['delmaxH3H1']=summary['Inci_H3_max']-summary['Inci_H1_Total_max']
# # pre/post pandemic number of years with predominance of H3
# setwd('~/Documents/P3_UIV/data/statistics/')
divMeanH3H1.h3 <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1>1) %>%
mutate(divmeanpredom = as.factor('H3 has higher average incidence'),
peakInci = Inci_H3_max)
divMeanH3H1.h1 <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1<1) %>%
mutate(divmeanpredom = as.factor('H1 has higher average incidence'),
peakInci = -Inci_H1_Total_max)
divMeanH3H1.eq <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1==1) %>%
mutate(divmeanpredom = as.factor('Equal Average Incidence'),
peakInci = 0)
divMeanH3H1 <- bind_rows(divMeanH3H1.h1,divMeanH3H1.h3,divMeanH3H1.eq)
# divMeanH3H1 <- divMeanH3H1 %>%
#   filter(Year>2008)
Country_num <- length(unique(divMeanH3H1$Country))
delmeanH3H1.h3 <- summary %>%
select(Country,Year,delmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(delmeanH3H1>0) %>%
mutate(delmeanpredom = as.factor('H3 has higher average incidence'),
peakInci=Inci_H3_max)
delmeanH3H1.h1 <- summary %>%
select(Country,Year,delmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(delmeanH3H1<0) %>%
mutate(delmeanpredom = as.factor('H1 has higher average incidence'),
peakInci=-Inci_H1_Total_max)
delmeanH3H1.eq <- summary %>%
select(Country,Year,delmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(delmeanH3H1==0) %>%
mutate(delmeanpredom = as.factor('Equal average incidence'),
peakInci=0)
delMeanH3H1 <- bind_rows(delmeanH3H1.h1,delmeanH3H1.h3,delmeanH3H1.eq)
# library(tidyverse)
# library(dplyr)
divMeanH3H1.ori <- divMeanH3H1
delMeanH3H1.ori <- delMeanH3H1
# # country - latitude
coords <- read.csv('~/Documents/P3_UIV/data/countries_codes_and_coordinates.csv')
divMeanH3H1 <- left_join(divMeanH3H1.ori,coords,by='Country')
delMeanH3H1 <- left_join(delMeanH3H1.ori,coords,by='Country')
country.order <- unique(arrange(divMeanH3H1,Latitude..average.)$Country)
divMeanH3H1$Country <- factor(divMeanH3H1$Country, levels=country.order)
country.order_del <- unique(arrange(delMeanH3H1,Latitude..average.)$Country)
delMeanH3H1$Country <- factor(delMeanH3H1$Country, levels=country.order_del)
divMeanH3H1.Ntemp <- divMeanH3H1 %>%
filter(Latitude..average.>23.5)
divMeanH3H1 <- divMeanH3H1.Ntemp
delMeanH3H1.Ntemp <- delMeanH3H1 %>%
filter(Latitude..average.>23.5)
delMeanH3H1 <- delMeanH3H1.Ntemp
delMaxH3H1.Ntemp <- delMaxH3H1 %>%
filter(Latitude..average.>23.5)
divMeanH3H1 <- left_join(divMeanH3H1.ori,coords,by='Country')
delMeanH3H1 <- left_join(delMeanH3H1.ori,coords,by='Country')
country.order <- unique(arrange(divMeanH3H1,Latitude..average.)$Country)
divMeanH3H1$Country <- factor(divMeanH3H1$Country, levels=country.order)
country.order_del <- unique(arrange(delMeanH3H1,Latitude..average.)$Country)
delMeanH3H1$Country <- factor(delMeanH3H1$Country, levels=country.order_del)
predom_count <- divMeanH3H1 %>%
dplyr::group_by(Country,divmeanpredom) %>%
dplyr::summarise(count=n())
total_count <- predom_count %>%
dplyr::group_by(Country) %>%
dplyr::summarise(total_count=sum(count))
H3_predom_prop <- dplyr::filter(predom_count,
divmeanpredom=='H3 has higher average incidence') %>%
dplyr::left_join(total_count,by='Country') %>%
mutate(H3_predom_prop=count/total_count) %>%
dplyr::left_join(coords,by='Country')
# # interval of h3 predominance
predom.yrs <- divMeanH3H1 %>%
group_by(Country,divmeanpredom) %>%
dplyr::arrange(Year) %>%
dplyr::mutate(yr.id=cumsum(c(1,diff(Year)>1)))
predom.yr.stats <- predom.yrs %>%
group_by(Country,divmeanpredom,yr.id) %>%
summarise(yr.n=n()) %>%
mutate(strain_predom=substr(divmeanpredom,start = 1,stop = 2))
# predom.yrs$Country <- factor(predom.yrs$Country,levels = country.order)
# predom.yrs.stats$Country <- factor(predom.yrs.stats$Country, levels=country.order)
predom.yrs.num.plot <- ggplot(data=predom.yr.stats,aes(x=yr.n,y=Country,fill=strain_predom))+
geom_boxplot()+
scale_fill_manual(values=c('#b4464b','steelblue'))+
theme_bw()+
theme(
# axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.title.x = element_text(size=9))+
labs(x='Number of consecutive\npredominant years',fill='Predominant\nstrain')
H3_predom_prop.plot <- H3_predom_prop %>%
ggplot(aes(x=H3_predom_prop,y=Country))+
geom_bar(stat = "identity",fill='steelblue')+
theme_bw()+
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.title.x = element_text(size=9))+
labs(x='Proportion of H3-predominant years')
divmean.p <- ggplot(data=divMeanH3H1,aes(x=Year,y=Country))+
geom_raster(aes(fill=peakInci),hjust = 0) +
scale_fill_gradient2(low="#b4464b", mid="lightgrey", high="steelblue",
na.value = "white") +
geom_hline(yintercept = seq_along(divMeanH3H1$Country) + 0.5) +
theme_bw(base_size = 10) +
annotate("rect", xmin = 2009, xmax = 2010,
ymin=seq_along(divMeanH3H1$Country)[1]-0.5,
ymax=seq_along(divMeanH3H1$Country)[length(unique(divMeanH3H1$Country))]+0.5)+
theme(panel.background = element_blank(),
panel.grid.major.x = element_line(color = "black"),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.ontop = TRUE,
axis.text.x=element_text(size=9, angle=0, vjust=0.3),
axis.text.y=element_text(size=9),
legend.title = element_blank(),
legend.text = element_text(size=9)) +
scale_x_continuous(breaks=seq(min(divMeanH3H1$Year)-1,max(divMeanH3H1$Year)))
predom.yrs.divmean.noh1h3grp <- divMeanH3H1 %>%
group_by(Country) %>%
arrange(Year) %>%
mutate(yr.id=cumsum(c(1,diff(Year)>1)))
divMeanH3H1.cor.h3h1seq <- predom.yrs.divmean.noh1h3grp %>%
dplyr::group_by(Country,yr.id) %>%
dplyr::mutate(pre_yr_divmeanpredom=dplyr::lag(divmeanpredom, order_by=Year),
des_yr_divmeanpredom=dplyr::lead(divmeanpredom, order_by=Year))
divMeanH3H1.cor.h3h1seq <- divMeanH3H1.cor.h3h1seq %>%
pivot_longer(c(pre_yr_divmeanpredom,des_yr_divmeanpredom),
names_to = 'preORdes', values_to = 'predom_strain')
divmean.cor.preyr.plot <-
ggplot(data=subset(divMeanH3H1.cor.h3h1seq,!is.na(predom_strain)),
aes(x=preORdes,y=Inci_H3_max,fill=predom_strain))+geom_boxplot()+
theme_classic()+labs(fill='Predominant strain',
y='H3 peak incidence in a year',x='')+
scale_x_discrete(labels=c("des_yr_divmeanpredom"="Strain predominance in\nthe following year",
"pre_yr_divmeanpredom"="Strain predominance in\nthe previous year"))
ggsave('divMean_latDesc.png',divmean.p,width=10,height=15)
ggsave('divMean+H3predom_latDesc.png',
gridExtra::arrangeGrob(divmean.p,H3_predom_prop.plot,ncol = 2,widths = c(0.8,0.2)),
width=12,height=7)
View(predom_count)
View(divMeanH3H1.ori)
predom.yrs.num.plot
# # pre/post pandemic number of years with predominance of H3
# setwd('~/Documents/P3_UIV/data/statistics/')
divMeanH3H1.h3 <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1>1) %>%
mutate(divmeanpredom = as.factor('H3 has higher average incidence'),
peakInci = Inci_H3_max)
divMeanH3H1.h1 <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1<1) %>%
mutate(divmeanpredom = as.factor('H1 has higher average incidence'),
peakInci = -Inci_H1_Total_max)
divMeanH3H1.eq <- summary %>%
select(Country,Year,divmeanH3H1,Inci_H3_max,Inci_H1_Total_max,
Inci_H3_mean,Inci_H1_Total_mean) %>%
filter(divmeanH3H1==1) %>%
mutate(divmeanpredom = as.factor('Equal Average Incidence'),
peakInci = 0)
divMeanH3H1 <- bind_rows(divMeanH3H1.h1,divMeanH3H1.h3,divMeanH3H1.eq)
divMeanH3H1 <- divMeanH3H1 %>%
mutate(peakInci_norm = (peakInci-min(peakINci))/(max(peakInci)-min(peakInci)))
divMeanH3H1 <- divMeanH3H1 %>%
mutate(peakInci_norm = (peakInci-min(peakInci))/(max(peakInci)-min(peakInci)))
View(divMeanH3H1)
divMeanH3H1 <- divMeanH3H1 %>%
mutate(peakInci_norm = scale(peakInci))
View(divMeanH3H1)
